---
title: Versión 2.0
sidebar_position: 1
---

# Versión 2.0

Esta versión introduce un cambio arquitectónico fundamental con respecto a la versión 1.0, transformando el plugin de una herramienta rígida a un ecosistema flexible y modular. La separación de responsabilidades entre el procesamiento del XML JATS, la orquestación del catálogo, la maquetación (TPL) y los estilos (CSS) cumple con el objetivo principal de eliminar la barrera de programación.

## Objetivos del Nuevo Diseño

*   **Autonomía y Descentralización del Diseño:** Permitir que cada revista tenga total autonomía sobre la estructura visual de su salida en PDF, sin depender de desarrollos de software para cada cambio estético.
*   **Eliminación de la Barrera de la Programación:** Facilitar modificaciones mediante una interfaz de configuración y el uso de tecnologías web estándar (HTML/CSS) en lugar de código PHP complejo.
*   **Flexibilidad de Estilos:** Implementación de "Cascading de CSS" para aplicar cambios estéticos sin invalidar la lógica base.
*   **Preservación Digital:** Garantizar que los archivos de salida cumplan con el estándar **PDF/A**, asegurando que el contenido sea autosuficiente para el archivado a largo plazo.

## Arquitectura Técnica

La arquitectura se ha redefinido para desacoplar el procesamiento del contenido de su presentación visual:

1.  **Nuevo Motor de Renderizado (mPDF + Smarty):** Se migró de TCPDF a mPDF integrado con motor de plantillas Smarty.
2.  **Modelo de "Catálogo":** Todo se basa en un modelo de catálogo (`catalog.xml`), donde se define la estructura que tendrá el PDF. El sistema procesa este XML, valida la existencia de los archivos referenciados y genera el documento.
3.  **Plantillas Dinámicas:** Ahora se utilizan archivos `.tpl` (pseudo-HTML) y CSS. Esto permite manipular la estructura del PDF como si fuera una página web.
4.  **Generación de PDF (mPDF):** Se utiliza la librería **mPDF** debido a su integración con Smarty y su capacidad de cumplir con estándares técnicos como PDF/A.

## Funcionalidades Clave

*   **Validación de Integridad:** El sistema valida toda la integridad de la plantilla (existencia del catálogo, archivos estructurales y referencias) antes de generar el PDF.
*   **Manejo de Imágenes y Logos:** Las imágenes se definen en el catálogo. Se soporta la subida de logos institucionales y de la revista como recursos configurables.
*   **Navegación Interna:** Soporte para citas y referencias navegables dentro del documento.
*   **Herencia de Plantillas:** Capacidad de extender una plantilla base, sobrescribiendo solo los archivos necesarios (HTML, CSS o imágenes) mientras se mantienen los originales como respaldo.

## Mejoras en el Procesamiento de Referencias

Se han implementado mejoras significativas en la intrepretación de metadatos de tesis y en el estilo de cita correspondiente (APA Custom), solucionando problemas de visualización en la distinción entre institución otorgante y repositorio.

### Ajustes en Mapeo de Datos (Thesis.php)
Se optimizó la lógica de extracción para las tesis, permitiendo distinguir y asignar correctamente los roles de las instituciones involucradas:

*   **Institución Otorgante:** Se prioriza la etiqueta `<institution>` o `<institution-name>`. Se mapea al campo `publisher` del CSL.
*   **Repositorio / Base de Datos:** Se utiliza la etiqueta `<publisher-name>`. Se mapea al campo `archive` del CSL.
*   **Número de Publicación:** Se extrae de `<publication-number>` o `<pub-id type="other">`.

> Anteriormente existía ambigüedad al renderizar estas dos entidades si ambas estaban presentes.

### Ajustes en Estilo CSL (apa-spanish-SUMARC.csl)
Se modificaron las macros `<macro name="number">` y `<macro name="format">` para alinear la salida visual con los requerimientos específicos de APA en español para tesis.

**Resultado Final:**
Las referencias de tesis ahora se renderizan siguiendo la estructura:
`Apellido, N. (2025). Título de la tesis (Nos. 12345) [Grado, Universidad Otorgante]. Nombre del Repositorio.`

| Antes | Después (v2.0) |
| :--- | :--- |
| `Apellido, N. (2025). Título (Tesis, Univ Nos. 123). Repositorio.` | `Apellido, N. (2025). Título (Nos. 123) [Tesis, Univ]. Repositorio.` |

