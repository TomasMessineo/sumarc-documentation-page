---
title: Version 2.0
sidebar_position: 1
---

# Version 2.0

This version introduces a fundamental architectural change compared to version 1.0, transforming the plugin from a rigid tool into a flexible and modular ecosystem. The separation of concerns between JATS XML processing, catalog orchestration, layout (TPL), and styling (CSS) fulfills the main objective of eliminating the programming barrier.

## Objectives of the New Design

*   **Autonomy and Design Decentralization:** Allow each journal to have full autonomy over the visual structure of its PDF output, without relying on software developments for every aesthetic change.
*   **Elimination of the Programming Barrier:** Facilitate modifications through a configuration interface and the use of standard web technologies (HTML/CSS) instead of complex PHP code.
*   **Style Flexibility:** Implementation of "CSS Cascading" to apply aesthetic changes without invalidating the base logic.
*   **Digital Preservation:** Ensure that output files comply with the **PDF/A** standard, guaranteeing that content is self-contained for long-term archiving.

## Technical Architecture

The architecture has been redefined to decouple content processing from its visual presentation:

1.  **New Rendering Engine (mPDF + Smarty):** Migrated from TCPDF to mPDF integrated with Smarty template engine.
2.  **"Catalog" Model:** Everything is based on a catalog model (`catalog.xml`), where the structure of the PDF is defined. The system processes this XML, validates the existence of referenced files, and generates the document.
3.  **Dynamic Templates:** Now uses `.tpl` files (pseudo-HTML) and CSS. This allows manipulating the PDF structure as if it were a web page.
4.  **PDF Generation (mPDF):** The **mPDF** library is used due to its integration with Smarty and its ability to comply with technical standards like PDF/A.

## Key Features

*   **Integrity Validation:** The system validates the entire integrity of the template (existence of the catalog, structural files, and references) before generating the PDF.
*   **Image and Logo Handling:** Images are defined in the catalog. It supports uploading institutional and journal logos as configurable resources.
*   **Internal Navigation:** Support for navigable citations and references within the document.
*   **Template Inheritance:** Ability to extend a base template, overwriting only the necessary files (HTML, CSS, or images) while keeping the originals as backup.

## Improvements in Reference Processing

Significant improvements have been implemented in the metadata interpretation for theses and the corresponding citation style (APA Custom), resolving visualization issues in distinguishing between the granting institution and the repository.

### Data Mapping Adjustments (Thesis.php)
The extraction logic for theses was optimized, allowing for the correct distinction and assignment of roles for the involved institutions:

*   **Granting Institution:** Priority is given to the `<institution>` or `<institution-name>` tag. It maps to the `publisher` CSL field.
*   **Repository / Database:** The `<publisher-name>` tag is used. It maps to the `archive` CSL field.
*   **Publication Number:** Extracted from `<publication-number>` or `<pub-id type="other">`.

> Previously, ambiguity existed when rendering these two entities if both were present.

### CSL Style Adjustments (apa-spanish-SUMARC.csl)
Macros `<macro name="number">` and `<macro name="format">` were modified to align the visual output with specific APA Spanish requirements for theses.

**Final Result:**
Thesis references now render following the structure:
`Surname, N. (2025). Thesis Title (Nos. 12345) [Degree, Granting University]. Repository Name.`

| Before | After (v2.0) |
| :--- | :--- |
| `Surname, N. (2025). Title (Thesis, Univ Nos. 123). Repository.` | `Surname, N. (2025). Title (Nos. 123) [Thesis, Univ]. Repository.` |

